"use strict";var h=Object.defineProperty;var f=(i,t,e)=>t in i?h(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var c=(i,t,e)=>(f(i,typeof t!="symbol"?t+"":t,e),e);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=i=>{const t=new DOMParser().parseFromString(i,"text/html"),e=new CustomEvent("xeon:navigated",{}),n=t.querySelector("body"),r=document.querySelector("body");r.innerHTML=n.innerHTML;const o=t.querySelector("head"),a=document.querySelector("head");a.innerHTML=o.innerHTML,window.dispatchEvent(e),window.Xeonic&&window.Xeonic.prefetchLinks()},l=i=>{const t=i.hasAttribute("xeon-ignore"),e=new URL(i.href||i.getAttribute("href")),n=e.hostname==window.Xeonic.siteInfo.hostname,r=!n,o=!!window.Xeonic.cachedLinks[e.href];return{ignored:t,fullURL:e,local:n,external:r,prefetched:o}};class w{constructor(){c(this,"config",{});c(this,"siteInfo",{hostname:location.hostname,protocol:location.protocol,pathname:location.pathname,port:location.port,href:location.href});c(this,"cachedLinks",{});c(this,"history",[]);c(this,"activeIndex",0);c(this,"prefetchLinks",async()=>{const t=document.querySelectorAll("a[href], [xeon-include]");for(let e=0;e<t.length;e++){const n=l(t[e]);if(n.ignored||n.external&&this.config.ignoreExternal||n.prefetched)return;this.cachedLinks[n.fullURL.href]=await fetch(n.fullURL.href).then(async r=>await r.text()),this.config.logs&&console.log(`\u26A1 - Prefetched ${n.fullURL.href}`)}});c(this,"goBack",()=>{const t=this.history[this.activeIndex-1],e=new CustomEvent("xeon:back",{detail:t});return this.config.logs&&console.log("\u26A1 - Going back"),t?(this.activeIndex--,window.dispatchEvent(e),this.goTo(t)):(window.dispatchEvent(e),window.history.back())});c(this,"goForward",()=>{const t=this.history[this.activeIndex+1],e=new CustomEvent("xeon:forward",{detail:t});return this.config.logs&&console.log("\u26A1 - Going forward"),t?(this.activeIndex++,window.dispatchEvent(e),this.goTo(t)):(window.dispatchEvent(e),window.history.forward())});c(this,"goTo",async t=>{const e=new URL(t),n=new CustomEvent("xeon:will-navigate",{detail:data.fullURL.href});return this.cachedLinks[e.href]=await fetch(e.href).then(async r=>await r.text()),this.config.logs&&console.log(`\u26A1 - Routed to ${e.href}`),this.activeIndex++,this.history.push(window.location.href),window.dispatchEvent(n),s(this.cachedLinks[e.href])});this.history.push(this.siteInfo.href)}}const u=(i={})=>{const{ignoreExternal:t=!0,prefetch:e=!0,logs:n=!1}=i;return window.Xeonic=new w,window.Xeonic.config={ignoreExternal:t,prefetch:e,logs:n},e&&window.Xeonic.prefetchLinks(),window.addEventListener("click",async r=>{if(r.target.tagName==="A"||r.target.hasAttribute("xeon-include")){const o=l(r.target);if(o.ignored||o.external&&t)return;r.preventDefault(),window.addEventListener("xeon:navigate",function(d){console.log(d)},!1);const a=new CustomEvent("xeon:will-navigate",{detail:o.fullURL.href});return window.dispatchEvent(a),o.prefetched?(window.Xeonic.activeIndex++,window.Xeonic.history.push(o.fullURL.href),n&&console.log(`\u26A1 - Routed to ${o.fullURL.href}`),s(window.Xeonic.cachedLinks[o.fullURL.href])):(window.Xeonic.cachedLinks[o.fullURL.href]=await fetch(o.fullURL.href).then(async d=>await d.text()),window.Xeonic.activeIndex++,window.Xeonic.history.push(o.fullURL.href),n&&console.log(`\u26A1 - Routed to ${o.fullURL.href}`),s(window.Xeonic.cachedLinks[o.fullURL.href]))}}),window.addEventListener("popstate",r=>{r.preventDefault();const o=new CustomEvent("xeon:will-navigate",{detail:data.fullURL.href});return window.dispatchEvent(o),window.Xeonic.activeIndex++,window.Xeonic.history.push(window.location.href),n&&console.log(`\u26A1 - Routed to ${window.location.href}`),s(window.Xeonic.cachedLinks[window.location.href])}),window.Xeonic};exports.initialiseRouter=u;
